(function($){$.fn.ajaxSubmit=function(_2){if(typeof _2=="function"){_2={success:_2};}_2=$.extend({url:this.attr("action")||window.location,type:this.attr("method")||"GET"},_2||{});var a=this.formToArray(_2.semantic);if(_2.beforeSubmit&&_2.beforeSubmit(a,this,_2)===false){return this;}var _4={};$.event.trigger("form.submit.validate",[a,this,_2,_4]);if(_4.veto){return this;}var q=$.param(a);if(_2.type.toUpperCase()=="GET"){_2.url+=(_2.url.indexOf("?")>=0?"&":"?")+q;_2.data=null;}else{_2.data=q;}var _6=this,callbacks=[];if(_2.resetForm){callbacks.push(function(){_6.resetForm();});}if(_2.clearForm){callbacks.push(function(){_6.clearForm();});}if(!_2.dataType&&_2.target){var _7=_2.success;callbacks.push(function(_8){$(_2.target).attr("innerHTML",_8).evalScripts().each(_7,arguments);});}else{if(_2.success){callbacks.push(_2.success);}}_2.success=function(_9,_a){for(var i=0,max=callbacks.length;i<max;i++){callbacks[i](_9,_a,_6);}};var _c=$("input:file",this).fieldValue();var _d=false;for(var j=0;j<_c.length;j++){if(_c[j]){_d=true;}}if(_2.iframe||_d){fileUpload();}else{$.ajax(_2);}$.event.trigger("form.submit.notify",[this,_2]);return this;function fileUpload(){var _f=_6[0];var _10=$.extend({},$.ajaxSettings,_2);var id="jqFormIO"+$.fn.ajaxSubmit.counter++;var $io=$("<iframe id=\""+id+"\" name=\""+id+"\" />");var io=$io[0];var op8=$.browser.opera&&window.opera.version()<9;if($.browser.msie||op8){io.src="javascript:false;document.write(\"\");";}$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var g=_10.global;if(g&&!$.active++){$.event.trigger("ajaxStart");}if(g){$.event.trigger("ajaxSend",[xhr,_10]);}var _17=0;var _18=0;setTimeout(function(){$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false);var _19=_f.encoding?"encoding":"enctype";var t=_6.attr("target");_6.attr({target:id,method:"POST",encAttr:"multipart/form-data",action:_10.url});if(_10.timeout){setTimeout(function(){_18=true;cb();},_10.timeout);}_f.submit();_6.attr("target",t);},10);function cb(){if(_17++){return;}io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var ok=true;try{if(_18){throw "timeout";}var _1c,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(_10.dataType=="json"||_10.dataType=="script"){var ta=doc.getElementsByTagName("textarea")[0];_1c=ta?ta.value:xhr.responseText;if(_10.dataType=="json"){eval("data = "+_1c);}else{$.globalEval(_1c);}}else{if(_10.dataType=="xml"){_1c=xhr.responseXML;if(!_1c&&xhr.responseText!=null){_1c=toXml(xhr.responseText);}}else{_1c=xhr.responseText;}}}catch(e){ok=false;$.handleError(_10,xhr,"error",e);}if(ok){_10.success(_1c,"success");if(g){$.event.trigger("ajaxSuccess",[xhr,_10]);}}if(g){$.event.trigger("ajaxComplete",[xhr,_10]);}if(g&&!--$.active){$.event.trigger("ajaxStop");}if(_10.complete){_10.complete(xhr,ok?"success":"error");}setTimeout(function(){$io.remove();xhr.responseXML=null;},100);}function toXml(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s);}else{doc=(new DOMParser()).parseFromString(s,"text/xml");}return (doc&&doc.documentElement&&doc.documentElement.tagName!="parsererror")?doc:null;}}};$.fn.ajaxSubmit.counter=0;$.fn.ajaxForm=function(_20){return this.ajaxFormUnbind().submit(submitHandler).each(function(){this.formPluginId=$.fn.ajaxForm.counter++;$.fn.ajaxForm.optionHash[this.formPluginId]=_20;$(":submit,input:image",this).click(clickHandler);});};$.fn.ajaxForm.counter=1;$.fn.ajaxForm.optionHash={};function clickHandler(e){var _22=this.form;_22.clk=this;if(this.type=="image"){if(e.offsetX!=undefined){_22.clk_x=e.offsetX;_22.clk_y=e.offsetY;}else{if(typeof $.fn.offset=="function"){var _23=$(this).offset();_22.clk_x=e.pageX-_23.left;_22.clk_y=e.pageY-_23.top;}else{_22.clk_x=e.pageX-this.offsetLeft;_22.clk_y=e.pageY-this.offsetTop;}}}setTimeout(function(){_22.clk=_22.clk_x=_22.clk_y=null;},10);}function submitHandler(){var id=this.formPluginId;var _25=$.fn.ajaxForm.optionHash[id];$(this).ajaxSubmit(_25);return false;}$.fn.ajaxFormUnbind=function(){this.unbind("submit",submitHandler);return this.each(function(){$(":submit,input:image",this).unbind("click",clickHandler);});};$.fn.formToArray=function(_26){var a=[];if(this.length==0){return a;}var _28=this[0];var els=_26?_28.getElementsByTagName("*"):_28.elements;if(!els){return a;}for(var i=0,max=els.length;i<max;i++){var el=els[i];var n=el.name;if(!n){continue;}if(_26&&_28.clk&&el.type=="image"){if(!el.disabled&&_28.clk==el){a.push({name:n+".x",value:_28.clk_x},{name:n+".y",value:_28.clk_y});}continue;}var v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(var j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}else{if(v!==null&&typeof v!="undefined"){a.push({name:n,value:v});}}}if(!_26&&_28.clk){var _2f=_28.getElementsByTagName("input");for(var i=0,max=_2f.length;i<max;i++){var _31=_2f[i];var n=_31.name;if(n&&!_31.disabled&&_31.type=="image"&&_28.clk==_31){a.push({name:n+".x",value:_28.clk_x},{name:n+".y",value:_28.clk_y});}}}return a;};$.fn.formSerialize=function(_33){return $.param(this.formToArray(_33));};$.fn.fieldSerialize=function(_34){var a=[];this.each(function(){var n=this.name;if(!n){return;}var v=$.fieldValue(this,_34);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}else{if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v});}}});return $.param(a);};$.fn.fieldValue=function(_39){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,_39);if(v===null||typeof v=="undefined"||(v.constructor==Array&&!v.length)){continue;}v.constructor==Array?$.merge(val,v):val.push(v);}return val;};$.fieldValue=function(el,_3e){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(typeof _3e=="undefined"){_3e=true;}if(_3e&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null;}if(tag=="select"){var _40=el.selectedIndex;if(_40<0){return null;}var a=[],ops=el.options;var one=(t=="select-one");var max=(one?_40+1:ops.length);for(var i=(one?_40:0);i<max;i++){var op=ops[i];if(op.selected){var v=$.browser.msie&&!(op.attributes["value"].specified)?op.text:op.value;if(one){return v;}a.push(v);}}return a;}return el.value;};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields();});};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=="text"||t=="password"||tag=="textarea"){this.value="";}else{if(t=="checkbox"||t=="radio"){this.checked=false;}else{if(tag=="select"){this.selectedIndex=-1;}}}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset();}});};})(jQuery);